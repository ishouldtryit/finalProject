<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="employee">
	
	<insert id="save">
		insert into employee(
			emp_no, emp_name, emp_password, emp_email,
			emp_phone, emp_address, emp_detail_address, emp_postcode,
			emp_hire_date, is_leave, cp_number, job_no, dept_no, wt_code
		)
		values(
			#{empNo}, #{empName}, #{empPassword}, #{empEmail},
			#{empPhone}, #{empAddress}, #{empDetailAddress}, #{empPostcode},
			sysdate, 'N', #{cpNumber}, #{jobNo}, #{deptNo}, #{wtCode}
		)
	</insert>
	
	<select id="find" resultType="employeeDto">
		select * from employee where emp_no = #{empNo}
	</select>
	
	<select id="list" resultType="employeeDto">
		select * from employee order by emp_no asc
	</select>
	
	<select id="count" resultType="int">
	 	 SELECT COUNT(*) FROM employee
	</select>
	
	<select id="getEmployeeList" resultType="employeeDto" parameterType="com.kh.synergyZone.vo.PaginationVO">
		  <![CDATA[
		  SELECT *
		  FROM (
		    SELECT e.*, ROWNUM AS rn
		    FROM employee e
		    WHERE ROWNUM <= #{end}
		  )
		  WHERE rn >= #{begin}
		  ]]>
	</select>
	
	<select id="searchEmployees" resultType="employeeDto">
    	select * from employee where instr(${column}, #{keyword}) >0 order by ${column} asc
    </select>
    
	<update id="edit">
		update employee set
		emp_name = #{empName}, emp_password = #{empPassword}, emp_email = #{empEmail},
		emp_phone = #{empPhone}, emp_hire_date = #{empHireDate}, is_leave = #{isLeave},
		cp_number = #{cpNumber}, job_no = #{jobNo}, dept_no = #{deptNo}, wt_code = #{wtCode}
		where emp_no = #{empNo}
	</update>
	
	<delete id="delete">
		delete from employee where emp_no = #{empNo}
	</delete>
	
	
	<resultMap type="paymentListVO" id="paymentListVO">
			<association property="deptDto">
				<result column="dept_no" property="deptNo"/>
				<result column="dept_name" property="deptName"/>
			</association>
			<collection property="paymentDetailList"
				javaType="java.util.List" ofType="employeeDto"
				select="treeSelectSub"
				column="dept_no">
				<result column="emp_no" property="paymentDetailNo"/>
				<result column="emp_name" property="paymentNo"/>
				<result column="emp_password" property="paymentDetailNo"/>
				<result column="emp_email" property="itemName"/>
				<result column="emp_phone" property="itemPrice"/>
				<result column="emp_address" property="itemQty"/>
				<result column="emp_detail_address" property="paymentDetailStatus"/>
				<result column="emp_postcode" property="paymentDetailStatus"/>
				<result column="emp_hire_date" property="paymentDetailStatus"/>
				<result column="is_leave" property="paymentDetailStatus"/>
				<result column="cp_number" property="paymentDetailStatus"/>
				<result column="job_no" property="paymentDetailStatus"/>
				<result column="dept_no" property="paymentDetailStatus"/>
				<result column="wt_code" property="paymentDetailStatus"/>
				<result column="emp_hire_date" property="paymentDetailStatus"/>
				<result column="emp_hire_date" property="paymentDetailStatus"/>
				
			</collection>
		</resultMap>
		
		
		<!-- 계층형 조회 메인 구문 -->
		<select id="treeSelect" resultMap="paymentListVO">
			select * from payment
			<if test="memberId != null">
				where member_id = #{memberId}
			</if>
			order by payment_no
		</select>
		
		<!-- 계층형 조회 서브 구문 -->
		<select id="treeSelectSub" resultType="paymentDetailDto">
			select*from payment_detail where payment_no = #{paymentNo}
		</select>
	
	
</mapper>
